#!/usr/bin/env bash

set -e

FILE=$1
FILE_ABSOLUTE_PATH="$(pwd)/$FILE"

extract() {
  EXTENSION=$1
  COMMAND="${@:2}"
  DIR="$(dirname "$FILE")/$(basename -s ".$EXTENSION" "$FILE")"

  echo "Extracting $FILE into $DIR"
  mkdir "$DIR"
  cd "$DIR"
  echo "$FILE_ABSOLUTE_PATH" | xargs -I%f $COMMAND
}

if [ -f "$FILE" ] ; then
    case "$FILE" in
        *.tar.bz2) extract 'tar.bz2' tar xvjf '%f'   ;;
        *.tar.gz)  extract 'tar.gz'  tar xvzf '%f'   ;;
        *.tar.xz)  extract 'tar.xz'  tar xvf '%f'    ;;
        *.bz2)     extract 'bz2'     bunzip2 '%f'    ;;
        *.rar)     extract "rar"     unrar x '%f'    ;;
        *.gz)      extract 'gz'      gunzip '%f'     ;;
        *.tar)     extract 'tar'     tar xvf '%f'    ;;
        *.tbz2)    extract 'tbz2'    tar xvjf '%f'   ;;
        *.tgz)     extract 'tgz'     tar xvzf '%f'   ;;
        *.zip)     extract 'zip'     unzip '%f'      ;;
        *.Z)       extract 'Z'       uncompress '%f' ;;
        *.7z)      extract '7z'      7z x '%f'       ;;
        *)         echo "Cannot extract '$FILE': Unrecognized file extension" ;;
    esac
else
    echo "Cannot extract '$FILE': File is unreadable"
fi
