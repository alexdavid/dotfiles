#!/usr/bin/env bash

set -e

if [ -f ~/.config/isdark ]; then
  rm ~/.config/isdark
  swaymsg 'bar bar-0 colors statusline #000000'
  cp ~/.config/alacritty/light.yml  ~/.config/alacritty/alacritty.yml
else
  touch ~/.config/isdark
  swaymsg 'bar bar-0 colors statusline #ffffff'
  cp ~/.config/alacritty/dark.yml  ~/.config/alacritty/alacritty.yml
fi

~/.config/wallpaper/set-wallpaper &
killall -s SIGUSR1 nvim || true

_ipc_socket="${XDG_RUNTIME_DIR}/qutebrowser/ipc-$(echo -n "$USER" | md5sum | cut -d' ' -f1)"

printf '{"args": [":config-source"], "target_arg": null, "version": "1.0.4", "protocol_version": 1, "cwd": "%s"}\n' \
       "${PWD}" | socat - UNIX-CONNECT:"${_ipc_socket}" 2>/dev/null
